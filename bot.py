import logging
import asyncio
import sqlite3
import random
import smtplib
import re
from datetime import datetime
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

from aiogram import Bot, Dispatcher, executor, types
from aiogram.contrib.fsm_storage.memory import MemoryStorage
from aiogram.dispatcher import FSMContext
from aiogram.dispatcher.filters.state import State, StatesGroup
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BOT_TOKEN = "7984506224:AAEd3y8AgaP-DjjFqVZ8RfW4Q71yOxgK65w"
ADMIN_IDS = [595041765, 6319553476]
DATABASE_NAME = 'bot.db'

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = Bot(token=BOT_TOKEN)
storage = MemoryStorage()
dp = Dispatcher(bot, storage=storage)

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS users (
                user_id INTEGER PRIMARY KEY,
                username TEXT,
                subscription_end DATE,
                reports_available INTEGER DEFAULT 1,
                referral_code TEXT UNIQUE,
                referred_by INTEGER,
                registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                is_premium BOOLEAN DEFAULT FALSE,
                total_reports_sent INTEGER DEFAULT 0,
                last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS sent_emails (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER,
                template_name TEXT,
                recipient_email TEXT,
                sent_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                status TEXT,
                FOREIGN KEY (user_id) REFERENCES users (user_id)
            )
        ''')
        conn.commit()
        conn.close()
        logger.info("Database initialized successfully")
    except Exception as e:
        logger.error(f"Database initialization error: {e}")

init_db()

# –°–æ—Å—Ç–æ—è–Ω–∏—è FSM
class ReportStates(StatesGroup):
    choosing_category = State()
    choosing_template = State()
    entering_email = State()
    entering_data = State()
    confirmation = State()

# –ë–∞–∑–∞ –ø–æ—á—Ç
EMAILS = {
    "kspeoadfipa@gmail.com": "wdox jfrh tncs pwic",
    "ao6557424@gmail.com": "mnuy jepq yvyc hjbr",
    "dlyabravla655@gmail.com": "kprn ihvr bgia vdys",
    "extrage523@gmail.com": "mphz wjrz iibv rvbr",
    "graciocnachleni@gmail.com": "qavg mbmx lotz uoph",
    "lofi04976@gmail.com": "nhdw luwd axpx kgrj",
    "lofipro43@gmail.com": "dqks iuoj ynis badb",
    "lofisnos@gmail.com": "twya atav adpl klhe",
    "penisone48@gmail.com": "aisn nywc fxyh pgkk",
    "rtrueqw@gmail.com": "kzhu vuom lker yugq",
    "snos6244@gmail.com": "gnpy beqw nqkd wlgk",
    "worklofishop8@gmail.com": "uxhv rxxm meps sjof",
    "worklofishop0@gmail.com": "cbjb viiq xfph jbcs",
    "danaislava1488@gmail.com": "robi xhez pxdh fshw",
    "mrcj141488@gmail.com": "hnad wyid mevr uwlz",
    "worklofishop215@gmail.com": "vuxf ndyv boje ledp",
    "asasadsjs@gmail.com": "qiuz edua zjfz utxi",
    "aleopo33@gmail.com": "gbfx svyk sdwq mpdv",
    "aumenaockovolosatoe38@gmail.com": "iqqr vtat oawj vczw",
    "gobllllllllll44@gmail.com": "ysxc xghk hgkf ffqg",
    "prostonaf7568@gmail.com": "lzjh tzbi uchb qfvv",
    "m4452736fdc@gmail.com": "mzai jzpk qpox zhxc",
    "rast34242@gmail.com": "qxqe jiba yxre bxtp"
}

# –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø
# –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø –ë–ï–ó –°–û–ö–†–ê–©–ï–ù–ò–ô
TEMPLATES = {
    "school": {
        "–ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥—É—é —à–∫–æ–ª—É": """–£–≤–∞–∂–∞–µ–º–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è —à–∫–æ–ª—ã!

–Ø, {—Ñ–∏–æ}, —É—á–∞—â–∏–π—Å—è {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–∞ {—à–∫–æ–ª–∞}, –æ–±—Ä–∞—â–∞—é—Å—å –∫ –í–∞–º —Å –ø—Ä–æ—Å—å–±–æ–π –æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ –º–æ–µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –í–∞—à–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ.

–í —Å–≤—è–∑–∏ —Å —Å–µ–º–µ–π–Ω—ã–º–∏ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏ (–ø–µ—Ä–µ–µ–∑–¥) —è –≤—ã–Ω—É–∂–¥–µ–Ω —Å–º–µ–Ω–∏—Ç—å –º–µ—Å—Ç–æ –æ–±—É—á–µ–Ω–∏—è. –ú–æ–∏ —Ä–æ–¥–∏—Ç–µ–ª–∏ –≥–æ—Ç–æ–≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –í–∞–º–∏ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è.

–î–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–≤—è–∑–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {—Ç–µ–ª–µ—Ñ–æ–Ω}
üë§ –§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è: {—Ñ–∏–æ_—Ä–æ–¥–∏—Ç–µ–ª—è}

–ü—Ä–æ—à—É –í–∞—Å —Å–æ–æ–±—â–∏—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º –ø–∞–∫–µ—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{—Ñ–∏–æ}""",

        "–ñ–∞–ª–æ–±–∞ –Ω–∞ —É—á–∏—Ç–µ–ª—è": """–£–≤–∞–∂–∞–µ–º—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä {—à–∫–æ–ª–∞}!

–Ø, {—Ñ–∏–æ_—Ä–æ–¥–∏—Ç–µ–ª—è}, —Ä–æ–¥–∏—Ç–µ–ª—å —É—á–µ–Ω–∏–∫–∞ {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–∞ {—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞}, –≤—ã–Ω—É–∂–¥–µ–Ω –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∂–∞–ª–æ–±–æ–π –Ω–∞ —É—á–∏—Ç–µ–ª—è {—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è}.

–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏:
‚Ä¢ –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–Ω–∏–∂–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–æ–≤
‚Ä¢ –ù–µ–æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏–π
‚Ä¢ –ù–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–∞
‚Ä¢ –ì—Ä—É–±—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è –≤ –∞–¥—Ä–µ—Å –¥–µ—Ç–µ–π

–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç –ø—Ä–æ–∏–∑–æ—à–µ–ª {–¥–∞—Ç–∞}, –∫–æ–≥–¥–∞ {–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞}.

–¢—Ä–µ–±—É—é:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–ª—É–∂–µ–±–Ω–æ–≥–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
2. –ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
3. –ü—É–±–ª–∏—á–Ω—ã—Ö –∏–∑–≤–∏–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —É—á–µ–Ω–∏–∫–æ–º

–ì–æ—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è.

–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏: {—Ç–µ–ª–µ—Ñ–æ–Ω}

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{—Ñ–∏–æ_—Ä–æ–¥–∏—Ç–µ–ª—è}""",

        "–î–æ–Ω–æ—Å –Ω–∞ —É—á–µ–Ω–∏–∫–∞": """–°–õ–£–ñ–ï–ë–ù–ê–Ø –ó–ê–ü–ò–°–ö–ê
–î–∏—Ä–µ–∫—Ç–æ—Ä—É {—à–∫–æ–ª–∞}
–æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞

–£–≤–∞–∂–∞–µ–º—ã–π {—Ñ–∏–æ_–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞}!

–î–æ–≤–æ–¥–∏–º –¥–æ –í–∞—à–µ–≥–æ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö —É—á–µ–±–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã —É—á–µ–Ω–∏–∫–æ–º {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–∞ {—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞}.

–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è:
‚úì –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤ (—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ —Å–∏–≥–∞—Ä–µ—Ç—ã)
‚úì –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥—Ä–∞–∫ –∏ –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–π
‚úì –ü–æ—Ä—á–∞ —à–∫–æ–ª—å–Ω–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞
‚úì –£–≥—Ä–æ–∑—ã –≤ –∞–¥—Ä–µ—Å –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤
‚úì –ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–∫–∞—Ö

–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª—É—á–∞–π: {–¥–∞—Ç–∞} - {–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞}

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º:
1. –°—Ä–æ—á–Ω—ã–π –≤—ã–∑–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
2. –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –æ –ø–µ—Ä–µ–≤–æ–¥–µ –≤ —Å–ø–µ—Ü—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

–ê–Ω–æ–Ω–∏–º–Ω–æ""",

        "–§–∞–ª—å—à–∏–≤—ã–π –∫–∞—Ä–∞–Ω—Ç–∏–Ω": """–≠–ö–°–¢–†–ï–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï
–†—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Å–ª—É–∂–±–µ {—à–∫–æ–ª–∞}

–£–í–ê–ñ–ê–ï–ú–´–ï –ö–û–õ–õ–ï–ì–ò!

–ü–æ—Å—Ç—É–ø–∏–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è {–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ} —É —É—á–µ–Ω–∏–∫–∞ {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–∞ {—Ñ–∏–æ}.

–î–∏–∞–≥–Ω–æ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω {–¥–∞—Ç–∞} –≤ {–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ_—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ}. 
–ò–Ω–∫—É–±–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥: {–ø–µ—Ä–∏–æ–¥} –¥–Ω–µ–π.

–≠–ü–ò–î–ï–ú–ò–û–õ–û–ì–ò–ß–ï–°–ö–ò–ï –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø:
‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –ª–∏—Ü
‚úÖ –î–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—è –ø–æ–º–µ—â–µ–Ω–∏–π {—Å–ø–∏—Å–æ–∫_–ø–æ–º–µ—â–µ–Ω–∏–π}
‚úÖ –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ {–¥–Ω–∏} –¥–Ω–µ–π
‚úÖ –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä–∞

–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: 
üè• {–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ_—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ}
üìû {—Ç–µ–ª–µ—Ñ–æ–Ω}

–ì–ª–∞–≤–Ω—ã–π –≤—Ä–∞—á {—Ñ–∏–æ_–≤—Ä–∞—á–∞}""",

        "–ü–æ–¥—Å—Ç–∞–≤–Ω–æ–π —Ä–æ–º–∞–Ω": """{—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è}, –º–Ω–µ –Ω—É–∂–Ω–æ —Å —Ç–æ–±–æ–π —Å—Ä–æ—á–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å.

–ù–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤—Å—Ç—Ä–µ—á–∞ {–¥–∞—Ç–∞} –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω–æ–π —Ç–≤–æ–µ–π —Å–µ–º—å–µ. –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –º—ã –æ–±–∞ —Å–æ–≤–µ—Ä—à–∏–ª–∏ –æ—à–∏–±–∫—É, –Ω–æ —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Ä–µ—à–∞—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.

–Ø –±–µ—Ä–µ–º–µ–Ω–Ω–∞. –°—Ä–æ–∫ - {—Å—Ä–æ–∫} –Ω–µ–¥–µ–ª—å. –¢–µ—Å—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏.

–ù–µ –¥–µ–ª–∞–π –Ω–∏—á–µ–≥–æ –≥–ª—É–ø–æ–≥–æ. –î–∞–≤–∞–π –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –∏ —Å–ø–æ–∫–æ–π–Ω–æ –≤—Å–µ –æ–±—Å—É–¥–∏–º. –Ø –Ω–µ —Ö–æ—á—É —Å–∫–∞–Ω–¥–∞–ª–∞, –Ω–æ –∏ –º–æ–ª—á–∞—Ç—å –Ω–µ –º–æ–≥—É.

–ú–æ–π –Ω–æ–º–µ—Ä: {—Ç–µ–ª–µ—Ñ–æ–Ω}
–í—Ä–µ–º—è –¥–ª—è –∑–≤–æ–Ω–∫–∞: —Å {–≤—Ä–µ–º—è_–Ω–∞—á–∞–ª–∞} –¥–æ {–≤—Ä–µ–º—è_–∫–æ–Ω—Ü–∞}

–ü—Ä–æ—à—É –æ—Ç–Ω–µ—Å—Ç–∏—Å—å –∫ —ç—Ç–æ–º—É —Å–µ—Ä—å–µ–∑–Ω–æ.
{–∞–Ω–æ–Ω–∏–º–Ω–æ–µ_–∏–º—è}""",

        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ": """{—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è}, —É –Ω–∞—Å –∫ —Ç–µ–±–µ –µ—Å—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.

–†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä—É—é—â–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–º–∏ —Ç–≤–æ—é —Å–≤—è–∑—å —Å {—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞} –∏–∑ {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–∞. 

–ò–º–µ—é—Ç—Å—è:
‚Ä¢ –§–æ—Ç–æ- –∏ –≤–∏–¥–µ–æ–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
‚Ä¢ –ü–µ—Ä–µ–ø–∏—Å–∫–∏ –ª–∏—á–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
‚Ä¢ –°–≤–∏–¥–µ—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å —É–≥–æ–ª–æ–≤–Ω–æ–≥–æ –¥–µ–ª–∞ –ø–æ —Å—Ç–∞—Ç—å–µ 135 –£–ö –†–§ "–†–∞–∑–≤—Ä–∞—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è", –≥–æ—Ç–æ–≤—å {—Å—É–º–º–∞} —Ä—É–±–ª–µ–π –∫ {–¥–∞—Ç–∞}.

–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É: {–Ω–æ–º–µ—Ä_–∫–∞—Ä—Ç—ã}
–î–µ—Ä–∂–∞—Ç–µ–ª—å: {—Ñ–∏–æ_–ø–æ–ª—É—á–∞—Ç–µ–ª—è}

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—É–¥—É—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã. 
–õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–ª–∏—Ü–∏—é –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

–ù–µ –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∞—Å.
–ê–Ω–æ–Ω–∏–º–Ω–∞—è –≥—Ä—É–ø–ø–∞""",

        "–§–µ–π–∫–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ": """–í–ê–ñ–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –î–õ–Ø –†–û–î–ò–¢–ï–õ–ï–ô
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è {—à–∫–æ–ª–∞}

–£–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏!

–í —Å–≤—è–∑–∏ —Å —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π, —Å–æ–±—Ä–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π —É—á–∞—â–∏—Ö—Å—è {–∫–ª–∞—Å—Å} –∫–ª–∞—Å—Å–æ–≤ –ü–ï–†–ï–ù–ï–°–ï–ù–û.

–ù–æ–≤—ã–µ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: {–¥–∞—Ç–∞} –≤ {–≤—Ä–µ–º—è}
–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: {–º–µ—Å—Ç–æ}

–ü–û–í–ï–°–¢–ö–ê –î–ù–Ø:
1. –í–æ–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
2. –ò–Ω—Ü–∏–¥–µ–Ω—Ç —Å {—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è} - —Å–ª—É–∂–µ–±–Ω–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
3. –í–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è
4. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–Ø–í–ö–ê –°–¢–†–û–ì–û –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê!
–ü—Ä–∏ —Å–µ–±–µ –∏–º–µ—Ç—å –ø–∞—Å–ø–æ—Ä—Ç –∏ –±–ª–æ–∫–Ω–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–µ–π.

–í —Å–ª—É—á–∞–µ –Ω–µ—è–≤–∫–∏ - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —É—á–∞—â–µ–≥–æ—Å—è.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–î–∏—Ä–µ–∫—Ç–æ—Ä {—Ñ–∏–æ_–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞}
–°–µ–∫—Ä–µ—Ç–∞—Ä—å: {—Ç–µ–ª–µ—Ñ–æ–Ω}"""
    },
    
    "swatting": {
        "–ú–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã": """–≠–ö–°–¢–†–ï–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï
–°–õ–£–ñ–ë–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò {–∞–¥—Ä–µ—Å}

–í –ó–î–ê–ù–ò–ò –®–ö–û–õ–´ –£–°–¢–ê–ù–û–í–õ–ï–ù–´ –í–ó–†–´–í–ù–´–ï –£–°–¢–†–û–ô–°–¢–í–ê!

–õ–æ–∫–∞—Ü–∏–∏:
‚Ä¢ –ì–ª–∞–≤–Ω—ã–π —Ö–æ–ª–ª - 3 –∫–≥ –≤ —Ç—Ä–æ—Ç–∏–ª–æ–≤–æ–º —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ
‚Ä¢ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∑–∞–ª - 5 –∫–≥ 
‚Ä¢ –°—Ç–æ–ª–æ–≤–∞—è - 2 –∫–≥

–¢–∏–ø –í–£: —Å–∞–º–æ–¥–µ–ª—å–Ω—ã–µ –≤–∑—Ä—ã–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–¢–∞–π–º–µ—Ä: 45 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è ({–≤—Ä–µ–º—è} + 00:45)

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è –≤ —Ä–∞–¥–∏—É—Å–µ 500 –º–µ—Ç—Ä–æ–≤
2. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
3. –ü—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç–æ–≤—ã—Ö –≤—ã—à–µ–∫ –≤ —Ä–∞–π–æ–Ω–µ
4. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–∞–ª—å–Ω–µ–π—à–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º

–≠–¢–û –ù–ï –£–ß–ï–ë–ù–ê–Ø –¢–†–ï–í–û–ì–ê!
–õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –¥–µ—Ç–æ–Ω–∞—Ü–∏–∏.

- –ì—Ä—É–ø–ø–∞ "–†–∞—Å—Å–≤–µ—Ç" """,

        "–ó–∞—Ö–≤–∞—Ç –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤": """–®–¢–£–†–ú–û–í–û–ô –û–¢–†–Ø–î –ù–ï –ü–†–ò–ë–´–í–ê–¢–¨!
{–∞–¥—Ä–µ—Å} - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø

–ü—Ä–æ–∏–∑–æ—à–µ–ª –∑–∞—Ö–≤–∞—Ç –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤ –≤ —É—á–µ–±–Ω–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏.

–°–¢–ê–¢–£–°:
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Ä—Ä–æ—Ä–∏—Å—Ç–æ–≤: 4-6 —á–µ–ª–æ–≤–µ–∫
‚Ä¢ –í–æ–æ—Ä—É–∂–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç—ã –ö–∞–ª–∞—à–Ω–∏–∫–æ–≤–∞, –≥—Ä–∞–Ω–∞—Ç—ã
‚Ä¢ –ó–∞–ª–æ–∂–Ω–∏–∫–∏: 50+ —É—á–µ–Ω–∏–∫–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: {—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è}

–£–°–õ–û–í–ò–Ø:
‚Ä¢ –†–∞–¥–∏—É—Å –æ—Ü–µ–ø–ª–µ–Ω–∏—è - 1 –∫–º
‚Ä¢ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞ –∏ —Å–≤—è–∑–∏
‚Ä¢ –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ {—Ç–µ–ª–µ—Ñ–æ–Ω}
‚Ä¢ –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ —Å–∏–ª–æ–≤–∏–∫–æ–≤ - —Ä–∞—Å—Å—Ç—Ä–µ–ª –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤

–°–†–û–ß–ù–û –î–û–í–ï–°–¢–ò –î–û –û–ü–ï–†–ê–¢–ò–í–ù–û–ì–û –®–¢–ê–ë–ê!
–ü–æ–≤—Ç–æ—Ä—è—é: —ç—Ç–æ –Ω–µ —É—á–µ–Ω–∏—è.

–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫""",

        "–í–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ": """–ö–û–î 99 - –ù–ê–ü–ê–î–ï–ù–ò–ï –ù–ê –û–ë–†–ê–ó–û–í–ê–¢–ï–õ–¨–ù–û–ï –£–ß–†–ï–ñ–î–ï–ù–ò–ï
{–∞–¥—Ä–µ—Å}

–°–ò–¢–£–ê–¶–ò–Ø –ù–ê {–≤—Ä–µ–º—è}:
‚Ä¢ 3 –≤–æ–æ—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞ –≤ –∑–¥–∞–Ω–∏–∏
‚Ä¢ –í–µ–¥—É—Ç –±–µ—Å–ø–æ—Ä—è–¥–æ—á–Ω—É—é —Å—Ç—Ä–µ–ª—å–±—É
‚Ä¢ –ï—Å—Ç—å –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–µ —Å—Ä–µ–¥–∏ —É—á–∞—â–∏—Ö—Å—è
‚Ä¢ –ü—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –ø–æ —ç—Ç–∞–∂–∞–º

–û–ü–ò–°–ê–ù–ò–ï –ù–ê–ü–ê–î–ê–í–®–ò–•:
‚Ä¢ –ú–∞—Å–∫–∏, —á–µ—Ä–Ω–∞—è —Ñ–æ—Ä–º–∞
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ä—É–∂–∏–µ
‚Ä¢ –î–µ–π—Å—Ç–≤—É—é—Ç —Å–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ

–¢–†–ï–ë–£–ï–¢–°–Ø:
1. –®—Ç—É—Ä–º–æ–≤–∞—è –≥—Ä—É–ø–ø–∞ —Å –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç–∞–º–∏
2. –°–Ω–∞–π–ø–µ—Ä—ã –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ö
3. –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è
4. –û—Ü–µ–ø–ª–µ–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏

–ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø!
–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –æ—á–µ–≤–∏–¥—Ü–∞"""
    },
    
    "corporate": {
        "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ": """–£–í–ê–ñ–ê–ï–ú–´–ô {—Ñ–∏–æ_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞}!
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è {–∫–æ–º–ø–∞–Ω–∏—è} —É–≤–µ–¥–æ–º–ª—è–µ—Ç –í–∞—Å –æ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–∏ —Ç—Ä—É–¥–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞.
–ü—Ä–∏—á–∏–Ω–∞: {–ø—Ä–∏—á–∏–Ω–∞_—É–≤–æ–ª—å–Ω–µ–Ω–∏—è}
–î–∞—Ç–∞ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è: {–¥–∞—Ç–∞}
–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤: {—Ç–µ–ª–µ—Ñ–æ–Ω_–æ—Ç–¥–µ–ª–∞}

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤ {–∫–æ–º–ø–∞–Ω–∏—è}""",

        "–ü—Ä–µ–º–∏—è": """–°–õ–£–ñ–ï–ë–ù–ê–Ø –ó–ê–ü–ò–°–ö–ê
–ö–æ–º—É: {—Ñ–∏–æ_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞}
–û—Ç: –û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤ {–∫–æ–º–ø–∞–Ω–∏—è}

–£–≤–µ–¥–æ–º–ª—è–µ–º –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –ø—Ä–µ–º–∏–∏ –≤ —Ä–∞–∑–º–µ—Ä–µ {—Å—É–º–º–∞} —Ä—É–±–ª–µ–π.
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é –¥–æ {–¥–∞—Ç–∞}.
–ù–µ—Ä–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.

–û—Å–Ω–æ–≤–∞–Ω–∏–µ: –ü—Ä–∏–∫–∞–∑ ‚Ññ{–Ω–æ–º–µ—Ä_–ø—Ä–∏–∫–∞–∑–∞} –æ—Ç {–¥–∞—Ç–∞_–ø—Ä–∏–∫–∞–∑–∞}""",

        "–ê—É–¥–∏—Ç": """–≠–ö–°–¢–†–ï–ù–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï
–í –æ—Ç–¥–µ–ª–µ {–æ—Ç–¥–µ–ª} –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –≤–Ω–µ–ø–ª–∞–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.
–î–∞—Ç–∞: {–¥–∞—Ç–∞}
–í—Ä–µ–º—è: {–≤—Ä–µ–º—è}
–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–µ: {—Ñ–∏–æ_–ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö}
–ü—Ä–∏—á–∏–Ω–∞: {–ø—Ä–∏—á–∏–Ω–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏}

–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤.
–ù–µ—è–≤–∫–∞ —Ä–∞—Å—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å–∞–±–æ—Ç–∞–∂.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–°–ª—É–∂–±–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è"""
    },
    
    "personal": {
        "–®–∞–Ω—Ç–∞–∂ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏": """{—Ñ–∏–æ_—Ü–µ–ª–∏}, —É –Ω–∞—Å –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–≤–æ–µ–π —Å–≤—è–∑–∏ —Å {—Ñ–∏–æ_–ø–∞—Ä—Ç–Ω–µ—Ä–∞}.
–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –ø—Ä–æ–±–ª–µ–º, –≤—ã–ø–æ–ª–Ω–∏ {—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è} –¥–æ {–¥–∞—Ç–∞}.
–ú–æ–ª—á–∏ - –∏ –≤—Å–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∞–º–∏.

–ù–µ –ø—ã—Ç–∞–π—Å—è –≤—ã–π—Ç–∏ –Ω–∞ —Å–≤—è–∑—å - –º—ã —Å–∞–º–∏ —Å —Ç–æ–±–æ–π —Å–≤—è–∂–µ–º—Å—è.
–õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–ª–∏—Ü–∏—é –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤.""",

        "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å": """{—Ñ–∏–æ_–º—É–∂—á–∏–Ω—ã}, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–µ—Ä—å–µ–∑–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å.
–Ø –±–µ—Ä–µ–º–µ–Ω–Ω–∞. –°—Ä–æ–∫ - {—Å—Ä–æ–∫} –Ω–µ–¥–µ–ª—å. –¢–µ—Å—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏.
–î–∞–≤–∞–π –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è {–¥–∞—Ç–∞} —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.

–ú–æ–π –Ω–æ–º–µ—Ä: {—Ç–µ–ª–µ—Ñ–æ–Ω}
–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ - —Å–∏—Ç—É–∞—Ü–∏—è —Å–µ—Ä—å–µ–∑–Ω–∞—è.

{–∞–Ω–æ–Ω–∏–º–Ω–æ–µ_–∏–º—è}""",

        "–î–æ–ª–≥": """{—Ñ–∏–æ_–¥–æ–ª–∂–Ω–∏–∫–∞}, –Ω–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –¥–æ–ª–≥–µ –≤ —Ä–∞–∑–º–µ—Ä–µ {—Å—É–º–º–∞} —Ä—É–±–ª–µ–π.
–°—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞: {–¥–∞—Ç–∞}.
–ü—Ä–∏ –Ω–µ–≤—ã–ø–ª–∞—Ç–µ –ø–µ—Ä–µ–¥–∞–¥–∏–º –¥–µ–ª–æ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞–º.

–ö–æ–Ω—Ç–∞–∫—Ç: {—Ç–µ–ª–µ—Ñ–æ–Ω_–∫—Ä–µ–¥–∏—Ç–æ—Ä–∞}
–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞: {—Ä–µ–∫–≤–∏–∑–∏—Ç—ã}

–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø—Ä–∞–≤–æ–≤—ã–º –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º."""
    },
    
    "government": {
        "–ù–∞–ª–æ–≥–∏": """–£–í–ï–î–û–ú–õ–ï–ù–ò–ï –ò–§–ù–°
–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω—É: {—Ñ–∏–æ}
–ê–¥—Ä–µ—Å: {–∞–¥—Ä–µ—Å}

–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –Ω–∞–ª–æ–≥–∞–º: {—Å—É–º–º–∞} —Ä—É–±–ª–µ–π.
–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã: {–¥–∞—Ç–∞}.
–ü—Ä–∏ –Ω–µ—É–ø–ª–∞—Ç–µ - —à—Ç—Ä–∞—Ñ 50% –æ—Ç —Å—É–º–º—ã –¥–æ–ª–≥–∞.

–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:
–ü–æ–ª—É—á–∞—Ç–µ–ª—å: –£–§–ö –ø–æ –≥. –ú–æ—Å–∫–≤–µ
–ò–ù–ù 7710168360 
–ö–ü–ü 771001001
–°—á–µ—Ç: 03100643000000012700
–ë–∞–Ω–∫: –ì–£ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ –ø–æ –¶–§–û
–ë–ò–ö: 044525000
–ö–ë–ö: 18210807010011000110
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–ø–ª–∞—Ç–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø–æ —Ç–µ–ª: {—Ç–µ–ª–µ—Ñ–æ–Ω_–∏–Ω—Å–ø–µ–∫—Ü–∏–∏}""",

        "–®—Ç—Ä–∞—Ñ—ã –ì–ò–ë–î–î": """–ü–û–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ì–ò–ë–î–î
–í–æ–¥–∏—Ç–µ–ª—å: {—Ñ–∏–æ}
–ù–æ–º–µ—Ä –∞–≤—Ç–æ: {–Ω–æ–º–µ—Ä_–∞–≤—Ç–æ}
–ù–∞—Ä—É—à–µ–Ω–∏–µ: {–Ω–∞—Ä—É—à–µ–Ω–∏–µ}
–®—Ç—Ä–∞—Ñ: {—Å—É–º–º–∞} —Ä—É–±–ª–µ–π
–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ: {–¥–∞—Ç–∞}

–û—Å–Ω–æ–≤–∞–Ω–∏–µ: —Å—Ç. 12.9 –ö–æ–ê–ü –†–§
–ü—Ä–æ—Ç–æ–∫–æ–ª ‚Ññ: {–Ω–æ–º–µ—Ä_–ø—Ä–æ—Ç–æ–∫–æ–ª–∞}
–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä: {—Ñ–∏–æ_–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞}

–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑: 
‚Ä¢ –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω
‚Ä¢ –ì–æ—Å—É—Å–ª—É–≥–∏
‚Ä¢ –¢–µ—Ä–º–∏–Ω–∞–ª—ã –æ–ø–ª–∞—Ç—ã

–ü—Ä–∏ –Ω–µ—Å–æ–≥–ª–∞—Å–∏–∏ –æ–±–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –¥–Ω–µ–π.""",

        "–ü–æ–≤–µ—Å—Ç–∫–∞ –≤ —Å—É–¥": """–ü–û–í–ï–°–¢–ö–ê –í –°–£–î
–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω—É: {—Ñ–∏–æ}
–Ø–≤–∏—Ç—å—Å—è: {–¥–∞—Ç–∞} –≤ {–≤—Ä–µ–º—è}
–ê–¥—Ä–µ—Å: {–∞–¥—Ä–µ—Å_—Å—É–¥–∞}
–ü—Ä–∏—á–∏–Ω–∞: {–ø—Ä–∏—á–∏–Ω–∞}

–ö–∞–±–∏–Ω–µ—Ç: {–∫–∞–±–∏–Ω–µ—Ç}
–°—É–¥—å—è: {—Ñ–∏–æ_—Å—É–¥—å–∏}
–ù–æ–º–µ—Ä –¥–µ–ª–∞: {–Ω–æ–º–µ—Ä_–¥–µ–ª–∞}

–ü—Ä–∏ –Ω–µ—è–≤–∫–µ –±–µ–∑ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–∏–≤–æ–¥.
–ü—Ä–∏ —Å–µ–±–µ –∏–º–µ—Ç—å –ø–∞—Å–ø–æ—Ä—Ç –∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –¥–µ–ª—É."""
    },
    
    "crypto": {
        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –±–∏—Ç–∫–æ–∏–Ω": """–í–ù–ò–ú–ê–ù–ò–ï! –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã.
–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ {—Å—É–º–º–∞_btc} BTC –Ω–∞ –∞–¥—Ä–µ—Å: {btc_–∞–¥—Ä–µ—Å}
–°—Ä–æ–∫: {–¥–∞—Ç–∞}
–ò–Ω–∞—á–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã.

–ú—ã –∏–º–µ–µ–º –¥–æ—Å—Ç—É–ø –∫:
‚Ä¢ –í–∞—à–µ–π –ø–µ—Ä–µ–ø–∏—Å–∫–µ
‚Ä¢ –õ–∏—á–Ω—ã–º —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ
‚Ä¢ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º
‚Ä¢ –ò—Å—Ç–æ—Ä–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã.
–ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–∫—Å–µ—Ä.""",

        "–ú–∞–π–Ω–∏–Ω–≥": """–ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï –û –°–û–¢–†–£–î–ù–ò–ß–ï–°–¢–í–ï
–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –º–∞–π–Ω–∏–Ω–≥ - –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å 300% –≤ –º–µ—Å—è—Ü!
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–∫–ª–∞–¥: {—Å—É–º–º–∞}
–ö–æ—à–µ–ª–µ–∫: {–∫–æ—à–µ–ª–µ–∫}
–ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞!

–ù–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ –õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π

–ü–µ—Ä–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞!
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç.""",

        "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞": """–í–ê–® –ö–û–®–ï–õ–ï–ö –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù
–ö–æ—à–µ–ª–µ–∫: {–∫–æ—à–µ–ª–µ–∫}
–ü—Ä–∏—á–∏–Ω–∞: {–ø—Ä–∏—á–∏–Ω–∞}
–î–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–ø–ª–∞—Ç–∏—Ç–µ {—Å—É–º–º–∞} –Ω–∞ {–∫–æ—à–µ–ª–µ–∫_–æ–ø–ª–∞—Ç—ã}
–°—Ä–æ–∫: {–¥–∞—Ç–∞}

–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ–º –≤ –æ—Ç–º—ã–≤–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤.
–ü—Ä–∏ –Ω–µ—É–ø–ª–∞—Ç–µ –∫–æ—à–µ–ª–µ–∫ –±—É–¥–µ—Ç permanently frozen.
–í—Å–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –∫–æ–Ω—Ñ–∏—Å–∫–æ–≤–∞–Ω—ã –≤ –ø–æ–ª—å–∑—É —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞.

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤."""
    }
}

# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def main_menu():
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    keyboard = InlineKeyboardMarkup(row_width=2)
    keyboard.row(
        InlineKeyboardButton("üéØ –°–æ–∑–¥–∞—Ç—å –¥–æ–Ω–æ—Å", callback_data="create_report"),
        InlineKeyboardButton("üë§ –ü—Ä–æ—Ñ–∏–ª—å", callback_data="profile")
    )
    keyboard.row(
        InlineKeyboardButton("üìä –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞", callback_data="referral"),
        InlineKeyboardButton("üíé –ü—Ä–µ–º–∏—É–º", callback_data="subscription")
    )
    if ADMIN_IDS:
        keyboard.row(InlineKeyboardButton("üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data="admin_panel"))
    return keyboard

def categories_menu():
    """–ú–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    keyboard = InlineKeyboardMarkup(row_width=2)
    keyboard.row(
        InlineKeyboardButton("üè´ –®–∫–æ–ª—å–Ω—ã–µ", callback_data="category_school"),
        InlineKeyboardButton("üö® –°–≤–∞—Ç—Ç–∏–Ω–≥", callback_data="category_swatting")
    )
    keyboard.row(
        InlineKeyboardButton("üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ", callback_data="category_corporate"),
        InlineKeyboardButton("üë• –õ–∏—á–Ω—ã–µ", callback_data="category_personal")
    )
    keyboard.row(
        InlineKeyboardButton("üèõÔ∏è –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ", callback_data="category_government"),
        InlineKeyboardButton("üíª –ö—Ä–∏–ø—Ç–æ–≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ", callback_data="category_crypto")
    )
    keyboard.row(InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_main"))
    return keyboard

def templates_menu(category):
    """–ú–µ–Ω—é —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    keyboard = InlineKeyboardMarkup()
    templates = TEMPLATES.get(category, {})
    for template_name in templates.keys():
        keyboard.add(InlineKeyboardButton(template_name, callback_data=f"template_{category}_{template_name}"))
    keyboard.add(InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_categories"))
    return keyboard

def confirmation_keyboard():
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"""
    keyboard = InlineKeyboardMarkup()
    keyboard.row(
        InlineKeyboardButton("‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å", callback_data="confirm_send"),
        InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel_send")
    )
    return keyboard

def admin_keyboard():
    """–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"""
    keyboard = InlineKeyboardMarkup()
    keyboard.add(InlineKeyboardButton("‚ûï –í—ã–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", callback_data="admin_give_sub"))
    keyboard.add(InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_stats"))
    keyboard.add(InlineKeyboardButton("üîÑ –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤", callback_data="admin_reset_limits"))
    keyboard.add(InlineKeyboardButton("üîô –ù–∞–∑–∞–¥", callback_data="back_main"))
    return keyboard

# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
def get_user_db(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î"""
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute(
            'SELECT reports_available, is_premium, total_reports_sent FROM users WHERE user_id = ?', 
            (user_id,)
        )
        result = cursor.fetchone()
        conn.close()
        return result
    except Exception as e:
        logger.error(f"Database error for user {user_id}: {e}")
        return None

def update_user_reports(user_id, decrement=False):
    """–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        
        if decrement:
            cursor.execute(
                'UPDATE users SET reports_available = reports_available - 1, total_reports_sent = total_reports_sent + 1 WHERE user_id = ?',
                (user_id,)
            )
        else:
            cursor.execute(
                'UPDATE users SET total_reports_sent = total_reports_sent + 1 WHERE user_id = ?',
                (user_id,)
            )
        
        cursor.execute(
            'UPDATE users SET last_activity = CURRENT_TIMESTAMP WHERE user_id = ?',
            (user_id,)
        )
        conn.commit()
        conn.close()
        return True
    except Exception as e:
        logger.error(f"Update user error: {e}")
        return False

def log_email_sent(user_id, template_name, recipient_email, status):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ email"""
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute(
            'INSERT INTO sent_emails (user_id, template_name, recipient_email, status) VALUES (?, ?, ?, ?)',
            (user_id, template_name, recipient_email, status)
        )
        conn.commit()
        conn.close()
    except Exception as e:
        logger.error(f"Email logging error: {e}")

# –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
@dp.message_handler(commands=['premium'])
async def give_premium_command(message: types.Message):
    """–í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫—É"""
    user_id = message.from_user.id
    if user_id not in ADMIN_IDS:
        await message.answer("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤")
        return
    
    try:
        target_id = int(message.text.split()[1])
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute('UPDATE users SET is_premium = TRUE WHERE user_id = ?', (target_id,))
        conn.commit()
        conn.close()
        
        await message.answer(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {target_id} –≤—ã–¥–∞–Ω–∞ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞!")
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            await bot.send_message(
                target_id,
                "üéâ –í–∞–º –≤—ã–¥–∞–Ω–∞ –ü–†–ï–ú–ò–£–ú –ü–û–î–ü–ò–°–ö–ê!\n\n"
                "–¢–µ–ø–µ—Ä—å —É –≤–∞—Å:\n"
                "‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –¥–æ–Ω–æ—Å—ã\n"
                "‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞\n"
                "üîí –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å"
            )
        except Exception:
            pass
            
    except (IndexError, ValueError):
        await message.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /premium USER_ID")
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message_handler(commands=['unlimited'])
async def unlimited_for_all(message: types.Message):
    """–í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º –≤—Å–µ–º"""
    user_id = message.from_user.id
    if user_id not in ADMIN_IDS:
        return
    
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute('UPDATE users SET is_premium = TRUE')
        conn.commit()
        conn.close()
        
        await message.answer("‚úÖ –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—ã–¥–∞–Ω–∞ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞!")
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@dp.message_handler(commands=['stats'])
async def stats_command(message: types.Message):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞"""
    user_id = message.from_user.id
    if user_id not in ADMIN_IDS:
        return
    
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        
        # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        cursor.execute('SELECT COUNT(*) FROM users')
        total_users = cursor.fetchone()[0]
        
        cursor.execute('SELECT COUNT(*) FROM users WHERE is_premium = TRUE')
        premium_users = cursor.fetchone()[0]
        
        cursor.execute('SELECT COUNT(*) FROM sent_emails')
        total_emails = cursor.fetchone()[0]
        
        cursor.execute('SELECT COUNT(*) FROM sent_emails WHERE date(sent_date) = date("now")')
        today_emails = cursor.fetchone()[0]
        
        conn.close()
        
        stats_text = (
            "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞:\n\n"
            f"üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
            f"üíé –ü—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {premium_users}\n"
            f"üìß –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å–µ–º: {total_emails}\n"
            f"üì® –ü–∏—Å–µ–º —Å–µ–≥–æ–¥–Ω—è: {today_emails}"
        )
        
        await message.answer(stats_text)
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {str(e)}")

# –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
@dp.message_handler(commands=['start'])
async def start_command(message: types.Message, state: FSMContext):
    """–ö–æ–º–∞–Ω–¥–∞ start"""
    await state.finish()
    user_id = message.from_user.id
    username = message.from_user.username
    
    # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
    args = message.get_args()
    if args and args.isdigit():
        referrer_id = int(args)
        if referrer_id != user_id:
            try:
                conn = sqlite3.connect(DATABASE_NAME)
                cursor = conn.cursor()
                cursor.execute('SELECT reports_available FROM users WHERE user_id = ?', (referrer_id,))
                result = cursor.fetchone()
                if result:
                    cursor.execute(
                        'UPDATE users SET reports_available = reports_available + 1 WHERE user_id = ?', 
                        (referrer_id,)
                    )
                conn.commit()
                conn.close()
            except Exception as e:
                logger.error(f"Referral error: {e}")
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute(
            'INSERT OR IGNORE INTO users (user_id, username, reports_available) VALUES (?, ?, 1)',
            (user_id, username)
        )
        conn.commit()
        conn.close()
    except Exception as e:
        logger.error(f"User registration error: {e}")
    
    await message.answer(
        "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SMTP Bot!\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=main_menu()
    )

@dp.callback_query_handler(lambda c: c.data == 'create_report')
async def create_report(callback: types.CallbackQuery, state: FSMContext):
    """–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–Ω–æ—Å–∞"""
    user_id = callback.from_user.id
    user_data = get_user_db(user_id)
    
    if not user_data:
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text="‚ùå –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
        )
        return
    
    reports_available, is_premium, total_sent = user_data
    
    if not is_premium and reports_available <= 0:
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text="‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–æ–Ω–æ—Å–æ–≤.\n\n"
                 "üíé –ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ!",
            reply_markup=main_menu()
        )
        return
    
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text="üéØ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–Ω–æ—Å–∞:",
        reply_markup=categories_menu()
    )
    await ReportStates.choosing_category.set()

@dp.callback_query_handler(lambda c: c.data.startswith('category_'), state=ReportStates.choosing_category)
async def choose_category(callback: types.CallbackQuery, state: FSMContext):
    """–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    category = callback.data.split("_")[1]
    
    category_names = {
        "school": "üè´ –®–∫–æ–ª—å–Ω—ã–µ",
        "swatting": "üö® –°–≤–∞—Ç—Ç–∏–Ω–≥", 
    }
    
    await state.update_data(category=category)
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text=f"üìù {category_names.get(category, category)} - –≤—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω:",
        reply_markup=templates_menu(category)
    )
    await ReportStates.choosing_template.set()

@dp.callback_query_handler(lambda c: c.data.startswith('template_'), state=ReportStates.choosing_template)
async def choose_template(callback: types.CallbackQuery, state: FSMContext):
    """–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞"""
    _, category, template = callback.data.split("_", 2)
    await state.update_data(template=template, category=category)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –¥–∞–Ω–Ω—ã—Ö —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò –ü–†–ò–ú–ï–†–ê–ú–ò –î–õ–Ø –í–°–ï–• –®–ê–ë–õ–û–ù–û–í
    hints = {
        # –®–∫–æ–ª—å–Ω—ã–µ
        "–î–æ–Ω–æ—Å –Ω–∞ —É—á–µ–Ω–∏–∫–∞": "üìã –§–æ—Ä–º–∞—Ç: –®–∫–æ–ª–∞, –§–ò–û –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞, –ö–ª–∞—Å—Å, –§–ò–û —É—á–µ–Ω–∏–∫–∞, –î–∞—Ç–∞, –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞\nüìå –ü—Ä–∏–º–µ—Ä: –®–∫–æ–ª–∞ ‚Ññ1, –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á, 10–ê, –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, 25.12.2024, –∫—É—Ä–∏–ª –≤ —Ç—É–∞–ª–µ—Ç–µ",
        "–ñ–∞–ª–æ–±–∞ –Ω–∞ —É—á–∏—Ç–µ–ª—è": "üìã –§–æ—Ä–º–∞—Ç: –®–∫–æ–ª–∞, –§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è, –ö–ª–∞—Å—Å, –§–ò–û —É—á–µ–Ω–∏–∫–∞, –§–ò–û —É—á–∏—Ç–µ–ª—è, –î–∞—Ç–∞, –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞, –¢–µ–ª–µ—Ñ–æ–Ω\nüìå –ü—Ä–∏–º–µ—Ä: –®–∫–æ–ª–∞ ‚Ññ15, –°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è, 8–ë, –°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π, –ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞, 20.12.2024, –æ—Å–∫–æ—Ä–±–∏–ª —É—á–µ–Ω–∏–∫–∞, +79161234567",
        "–ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥—É—é —à–∫–æ–ª—É": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —É—á–µ–Ω–∏–∫–∞, –ö–ª–∞—Å—Å, –®–∫–æ–ª–∞, –¢–µ–ª–µ—Ñ–æ–Ω, –§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, 9–ê, –®–∫–æ–ª–∞ ‚Ññ5, +79161234567, –ò–≤–∞–Ω–æ–≤–∞ –û–ª—å–≥–∞",
        "–§–∞–ª—å—à–∏–≤—ã–π –∫–∞—Ä–∞–Ω—Ç–∏–Ω": "üìã –§–æ—Ä–º–∞—Ç: –®–∫–æ–ª–∞, –ó–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ, –ö–ª–∞—Å—Å, –§–ò–û —É—á–µ–Ω–∏–∫–∞, –î–∞—Ç–∞, –ú–µ–¥ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ, –ü–µ—Ä–∏–æ–¥, –ü–æ–º–µ—â–µ–Ω–∏—è, –î–Ω–∏, –¢–µ–ª–µ—Ñ–æ–Ω, –§–ò–û –≤—Ä–∞—á–∞\nüìå –ü—Ä–∏–º–µ—Ä: –®–∫–æ–ª–∞ ‚Ññ3, COVID-19, 7–ë, –°–µ—Ä–≥–µ–µ–≤ –ê–ª–µ–∫—Å, 18.12.2024, –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ1, 14 –¥–Ω–µ–π, –∫–ª–∞—Å—Å—ã 1-3, 10, +79161234567, –°–º–∏—Ä–Ω–æ–≤ –ê.–í.",
        "–ü–æ–¥—Å—Ç–∞–≤–Ω–æ–π —Ä–æ–º–∞–Ω": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —É—á–∏—Ç–µ–ª—è, –î–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏, –°—Ä–æ–∫ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏, –¢–µ–ª–µ—Ñ–æ–Ω, –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞, –í—Ä–µ–º—è –∫–æ–Ω—Ü–∞, –ê–Ω–æ–Ω–∏–º–Ω–æ–µ –∏–º—è\nüìå –ü—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–Ω–∞, 15.12.2024, 8 –Ω–µ–¥–µ–ª—å, +79161234567, 14:00, 16:00, –ú–∞—Ä–∏—è",
        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —É—á–∏—Ç–µ–ª—è, –§–ò–û —É—á–µ–Ω–∏–∫–∞, –ö–ª–∞—Å—Å, –°—É–º–º–∞, –î–∞—Ç–∞, –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ü–µ—Ç—Ä, –°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞, 11–ê, 50000, 25.12.2024, 1234567812345678, –°–µ—Ä–≥–µ–µ–≤ –ú.–ò.",
        "–§–µ–π–∫–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ": "üìã –§–æ—Ä–º–∞—Ç: –®–∫–æ–ª–∞, –ö–ª–∞—Å—Å, –î–∞—Ç–∞, –í—Ä–µ–º—è, –ú–µ—Å—Ç–æ, –§–ò–û —É—á–∏—Ç–µ–ª—è, –§–ò–û –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞, –¢–µ–ª–µ—Ñ–æ–Ω\nüìå –ü—Ä–∏–º–µ—Ä: –®–∫–æ–ª–∞ ‚Ññ7, 5-11 –∫–ª–∞—Å—Å—ã, 28.12.2024, 18:00, –ê–∫—Ç–æ–≤—ã–π –∑–∞–ª, –ü–µ—Ç—Ä–æ–≤ –ò.–°., –°–∏–¥–æ—Ä–æ–≤ –ê.–í., +79161234567",
        
        # –°–≤–∞—Ç—Ç–∏–Ω–≥
        "–ú–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã": "üìã –§–æ—Ä–º–∞—Ç: –ê–¥—Ä–µ—Å, –í—Ä–µ–º—è\nüìå –ü—Ä–∏–º–µ—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞ 15, 14:30",
        "–ó–∞—Ö–≤–∞—Ç –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤": "üìã –§–æ—Ä–º–∞—Ç: –ê–¥—Ä–µ—Å, –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –¢–µ–ª–µ—Ñ–æ–Ω\nüìå –ü—Ä–∏–º–µ—Ä: —É–ª. –®–∫–æ–ª—å–Ω–∞—è 10, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã—Ö, +79161234567",
        "–í–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ": "üìã –§–æ—Ä–º–∞—Ç: –ê–¥—Ä–µ—Å, –í—Ä–µ–º—è\nüìå –ü—Ä–∏–º–µ—Ä: —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è 25, 15:00",
        
        # –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ
        "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –ö–æ–º–ø–∞–Ω–∏—è, –ü—Ä–∏—á–∏–Ω–∞ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –î–∞—Ç–∞, –¢–µ–ª–µ—Ñ–æ–Ω –æ—Ç–¥–µ–ª–∞\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, –û–û–û –†–æ–º–∞—à–∫–∞, –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ç—Ä—É–¥–æ–≤–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, 25.12.2024, +79161234567",
        "–ü—Ä–µ–º–∏—è": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –ö–æ–º–ø–∞–Ω–∏—è, –°—É–º–º–∞, –î–∞—Ç–∞, –ù–æ–º–µ—Ä –ø—Ä–∏–∫–∞–∑–∞, –î–∞—Ç–∞ –ø—Ä–∏–∫–∞–∑–∞\nüìå –ü—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, –ê–û –°—Ç—Ä–æ–π–∫–∞, 50000, 20.12.2024, 245, 18.12.2024",
        "–ê—É–¥–∏—Ç": "üìã –§–æ—Ä–º–∞—Ç: –û—Ç–¥–µ–ª, –î–∞—Ç–∞, –í—Ä–µ–º—è, –§–ò–û –ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö, –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏\nüìå –ü—Ä–∏–º–µ—Ä: –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂, 22.12.2024, 10:00, –°–∏–¥–æ—Ä–æ–≤ –ê.–í.; –ò–≤–∞–Ω–æ–≤–∞ –ú.–ö., –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏",
        
        # –õ–∏—á–Ω—ã–µ
        "–®–∞–Ω—Ç–∞–∂ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û —Ü–µ–ª–∏, –§–ò–û –ø–∞—Ä—Ç–Ω–µ—Ä–∞, –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –î–∞—Ç–∞\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è, –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ 100000 —Ä—É–±–ª–µ–π, 25.12.2024",
        "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û –º—É–∂—á–∏–Ω—ã, –°—Ä–æ–∫, –î–∞—Ç–∞, –¢–µ–ª–µ—Ñ–æ–Ω, –ê–Ω–æ–Ω–∏–º–Ω–æ–µ –∏–º—è\nüìå –ü—Ä–∏–º–µ—Ä: –°–µ—Ä–≥–µ–µ–≤ –ê–ª–µ–∫—Å–µ–π, 12 –Ω–µ–¥–µ–ª—å, 20.12.2024, +79161234567, –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
        "–î–æ–ª–≥": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û –¥–æ–ª–∂–Ω–∏–∫–∞, –°—É–º–º–∞, –î–∞—Ç–∞, –¢–µ–ª–µ—Ñ–æ–Ω –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞, –†–µ–∫–≤–∏–∑–∏—Ç—ã\nüìå –ü—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, 150000, 25.12.2024, +79161234567, –∫–∞—Ä—Ç–∞ 1234567812345678",
        
        # –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ
        "–ù–∞–ª–æ–≥–∏": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û, –ê–¥—Ä–µ—Å, –°—É–º–º–∞, –î–∞—Ç–∞, –¢–µ–ª–µ—Ñ–æ–Ω –∏–Ω—Å–ø–µ–∫—Ü–∏–∏\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á, –≥. –ú–æ—Å–∫–≤–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞ 1, 25000, 25.12.2024, +74951234567",
        "–®—Ç—Ä–∞—Ñ—ã –ì–ò–ë–î–î": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û, –ù–æ–º–µ—Ä –∞–≤—Ç–æ, –ù–∞—Ä—É—à–µ–Ω–∏–µ, –°—É–º–º–∞, –î–∞—Ç–∞, –ù–æ–º–µ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –§–ò–û –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞\nüìå –ü—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á, –ê123–ë–í777, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏, 5000, 20.12.2024, 188456, –°–∏–¥–æ—Ä–æ–≤ –ê.–í.",
        "–ü–æ–≤–µ—Å—Ç–∫–∞ –≤ —Å—É–¥": "üìã –§–æ—Ä–º–∞—Ç: –§–ò–û, –î–∞—Ç–∞, –í—Ä–µ–º—è, –ê–¥—Ä–µ—Å —Å—É–¥–∞, –ü—Ä–∏—á–∏–Ω–∞, –ö–∞–±–∏–Ω–µ—Ç, –§–ò–û —Å—É–¥—å–∏, –ù–æ–º–µ—Ä –¥–µ–ª–∞\nüìå –ü—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò., 28.12.2024, 14:30, —É–ª. –ü—Ä–∞–≤–¥—ã 15, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –∏—Å–∫, 305, –ü–µ—Ç—Ä–æ–≤–∞ –ú.–ò., 2-456/2024",
        
        # –ö—Ä–∏–ø—Ç–æ–≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ
        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –±–∏—Ç–∫–æ–∏–Ω": "üìã –§–æ—Ä–º–∞—Ç: –°—É–º–º–∞ BTC, BTC –∞–¥—Ä–µ—Å, –î–∞—Ç–∞\nüìå –ü—Ä–∏–º–µ—Ä: 0.5, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, 25.12.2024",
        "–ú–∞–π–Ω–∏–Ω–≥": "üìã –§–æ—Ä–º–∞—Ç: –°—É–º–º–∞, –ö–æ—à–µ–ª–µ–∫\nüìå –ü—Ä–∏–º–µ—Ä: 50000, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX",
        "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞": "üìã –§–æ—Ä–º–∞—Ç: –ö–æ—à–µ–ª–µ–∫, –ü—Ä–∏—á–∏–Ω–∞, –°—É–º–º–∞, –ö–æ—à–µ–ª–µ–∫ –æ–ø–ª–∞—Ç—ã, –î–∞—Ç–∞\nüìå –ü—Ä–∏–º–µ—Ä: 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –≤ –æ—Ç–º—ã–≤–∞–Ω–∏–∏, 0.1, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, 25.12.2024"
    }
    
    hint = hints.get(template, "üìã –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ")
    
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text=f"üìß –í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è:\n\n"
             f"üìã –®–∞–±–ª–æ–Ω: {template}\n"
             f"üí° {hint}",
    )
    await ReportStates.entering_email.set()

@dp.message_handler(state=ReportStates.entering_email)
async def enter_email(message: types.Message, state: FSMContext):
    """–í–≤–æ–¥ email"""
    email = message.text.strip().lower()
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è email
    email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    if not re.match(email_pattern, email):
        await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:")
        return
    
    await state.update_data(email=email)
    
    data = await state.get_data()
    template = data['template']
    
    await message.answer(
        f"üìù –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞:\n"
        f"üìã –®–∞–±–ª–æ–Ω: {template}\n"
        f"üìß Email: {email}\n\n"
        f"üí° –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ"
    )
    await ReportStates.entering_data.set()

@dp.message_handler(state=ReportStates.entering_data)
async def enter_data(message: types.Message, state: FSMContext):
    """–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö"""
    user_data = message.text.strip()
    if not user_data:
        await message.answer("‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:")
        return
    
    await state.update_data(user_data=user_data)
    
    data = await state.get_data()
    
    # –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø
    examples = {
        # –®–∫–æ–ª—å–Ω—ã–µ
        "–î–æ–Ω–æ—Å –Ω–∞ —É—á–µ–Ω–∏–∫–∞": "–®–∫–æ–ª–∞ ‚Ññ1, –ò–≤–∞–Ω–æ–≤ –ò.–ò., 10–ê, –ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, 25.12.2024, –∫—É—Ä–∏–ª –≤ —Ç—É–∞–ª–µ—Ç–µ",
        "–ñ–∞–ª–æ–±–∞ –Ω–∞ —É—á–∏—Ç–µ–ª—è": "–®–∫–æ–ª–∞ ‚Ññ15, –°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è, 8–ë, –°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π, –ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞, 20.12.2024, –æ—Å–∫–æ—Ä–±–∏–ª —É—á–µ–Ω–∏–∫–∞, +79161234567",
        "–ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥—É—é —à–∫–æ–ª—É": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, 9–ê, –®–∫–æ–ª–∞ ‚Ññ5, +79161234567, –ò–≤–∞–Ω–æ–≤–∞ –û–ª—å–≥–∞",
        "–§–∞–ª—å—à–∏–≤—ã–π –∫–∞—Ä–∞–Ω—Ç–∏–Ω": "–®–∫–æ–ª–∞ ‚Ññ3, COVID-19, 7–ë, –°–µ—Ä–≥–µ–µ–≤ –ê–ª–µ–∫—Å, 18.12.2024, –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ1, 14 –¥–Ω–µ–π, –∫–ª–∞—Å—Å—ã 1-3, 10, +79161234567, –°–º–∏—Ä–Ω–æ–≤ –ê.–í.",
        "–ü–æ–¥—Å—Ç–∞–≤–Ω–æ–π —Ä–æ–º–∞–Ω": "–ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–Ω–∞, 15.12.2024, 8 –Ω–µ–¥–µ–ª—å, +79161234567, 14:00, 16:00, –ú–∞—Ä–∏—è",
        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ": "–ò–≤–∞–Ω–æ–≤ –ü–µ—Ç—Ä, –°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞, 11–ê, 50000, 25.12.2024, 1234567812345678, –°–µ—Ä–≥–µ–µ–≤ –ú.–ò.",
        "–§–µ–π–∫–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ": "–®–∫–æ–ª–∞ ‚Ññ7, 5-11 –∫–ª–∞—Å—Å—ã, 28.12.2024, 18:00, –ê–∫—Ç–æ–≤—ã–π –∑–∞–ª, –ü–µ—Ç—Ä–æ–≤ –ò.–°., –°–∏–¥–æ—Ä–æ–≤ –ê.–í., +79161234567",
        
        # –°–≤–∞—Ç—Ç–∏–Ω–≥
        "–ú–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã": "—É–ª. –õ–µ–Ω–∏–Ω–∞ 15, 14:30",
        "–ó–∞—Ö–≤–∞—Ç –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤": "—É–ª. –®–∫–æ–ª—å–Ω–∞—è 10, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã—Ö, +79161234567",
        "–í–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ": "—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è 25, 15:00",
        
        # –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ
        "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, –û–û–û –†–æ–º–∞—à–∫–∞, –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ç—Ä—É–¥–æ–≤–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, 25.12.2024, +79161234567",
        "–ü—Ä–µ–º–∏—è": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, –ê–û –°—Ç—Ä–æ–π–∫–∞, 50000, 20.12.2024, 245, 18.12.2024",
        "–ê—É–¥–∏—Ç": "–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂, 22.12.2024, 10:00, –°–∏–¥–æ—Ä–æ–≤ –ê.–í.; –ò–≤–∞–Ω–æ–≤–∞ –ú.–ö., –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏",
        
        # –õ–∏—á–Ω—ã–µ
        "–®–∞–Ω—Ç–∞–∂ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è, –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ 100000 —Ä—É–±–ª–µ–π, 25.12.2024",
        "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å": "–°–µ—Ä–≥–µ–µ–≤ –ê–ª–µ–∫—Å–µ–π, 12 –Ω–µ–¥–µ–ª—å, 20.12.2024, +79161234567, –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
        "–î–æ–ª–≥": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä, 150000, 25.12.2024, +79161234567, –∫–∞—Ä—Ç–∞ 1234567812345678",
        
        # –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ
        "–ù–∞–ª–æ–≥–∏": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á, –≥. –ú–æ—Å–∫–≤–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞ 1, 25000, 25.12.2024, +74951234567",
        "–®—Ç—Ä–∞—Ñ—ã –ì–ò–ë–î–î": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á, –ê123–ë–í777, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏, 5000, 20.12.2024, 188456, –°–∏–¥–æ—Ä–æ–≤ –ê.–í.",
        "–ü–æ–≤–µ—Å—Ç–∫–∞ –≤ —Å—É–¥": "–ò–≤–∞–Ω–æ–≤ –ò.–ò., 28.12.2024, 14:30, —É–ª. –ü—Ä–∞–≤–¥—ã 15, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –∏—Å–∫, 305, –ü–µ—Ç—Ä–æ–≤–∞ –ú.–ò., 2-456/2024",
        
        # –ö—Ä–∏–ø—Ç–æ–≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ
        "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –±–∏—Ç–∫–æ–∏–Ω": "0.5, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, 25.12.2024",
        "–ú–∞–π–Ω–∏–Ω–≥": "50000, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX",
        "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞": "17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –≤ –æ—Ç–º—ã–≤–∞–Ω–∏–∏, 0.1, 17vPx2X9W2Gb4HKu1AxCvbcEVa77G38fYX, 25.12.2024"
    }
    
    example = examples.get(data['template'], "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
    
    await message.answer(
        f"üìã –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É:\n\n"
        f"üìß Email: {data['email']}\n"
        f"üìù –®–∞–±–ª–æ–Ω: {data['template']}\n"
        f"üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {data['category']}\n"
        f"üë§ –î–∞–Ω–Ω—ã–µ: {data['user_data']}\n\n"
        f"üí° –ü—Ä–∏–º–µ—Ä: {example}\n\n"
        f"–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ?",
        reply_markup=confirmation_keyboard()
    )
    await ReportStates.confirmation.set()

@dp.callback_query_handler(lambda c: c.data == 'confirm_send', state=ReportStates.confirmation)
async def confirm_send(callback: types.CallbackQuery, state: FSMContext):
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏"""
    data = await state.get_data()
    user_id = callback.from_user.id
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
    user_data = get_user_db(user_id)
    if not user_data:
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text="‚ùå –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
        )
        await state.finish()
        return
    
    reports_available, is_premium, total_sent = user_data
    
    if not is_premium and reports_available <= 0:
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text="‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–æ–Ω–æ—Å–æ–≤."
        )
        await state.finish()
        return
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
    try:
        success = await send_email(
            data['email'], 
            data['template'], 
            data['user_data'], 
            data['category']
        )
        
        if success:
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            update_user_reports(user_id, decrement=not is_premium)
            log_email_sent(user_id, data['template'], data['email'], "success")
            
            new_reports = reports_available - 1 if not is_premium else '‚àû'
            
            await bot.edit_message_text(
                chat_id=callback.message.chat.id,
                message_id=callback.message.message_id,
                text=f"‚úÖ –ü–∏—Å—å–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n"
                     f"üìß –ü–æ–ª—É—á–∞—Ç–µ–ª—å: {data['email']}\n"
                     f"üìù –®–∞–±–ª–æ–Ω: {data['template']}\n"
                     f"üîÑ –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–Ω–æ—Å–æ–≤: {new_reports}"
            )
        else:
            log_email_sent(user_id, data['template'], data['email'], "failed")
            await bot.edit_message_text(
                chat_id=callback.message.chat.id,
                message_id=callback.message.message_id,
                text="‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞"
            )
            
    except Exception as e:
        logger.error(f"Send email error: {e}")
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text=f"‚ùå –û—à–∏–±–∫–∞: {str(e)}"
        )
    
    await state.finish()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
@dp.callback_query_handler(lambda c: c.data == 'cancel_send', state='*')
async def cancel_send(callback: types.CallbackQuery, state: FSMContext):
    """–û—Ç–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏"""
    await state.finish()
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text="‚ùå –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞.",
        reply_markup=main_menu()
    )

@dp.callback_query_handler(lambda c: c.data == 'back_main', state='*')
async def back_main(callback: types.CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    await state.finish()
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text="üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SMTP Bot!\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=main_menu()
    )

@dp.callback_query_handler(lambda c: c.data == 'back_categories', state='*')
async def back_categories(callback: types.CallbackQuery, state: FSMContext):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"""
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text="üéØ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–Ω–æ—Å–∞:",
        reply_markup=categories_menu()
    )
    await ReportStates.choosing_category.set()

# –ü—Ä–æ—Ñ–∏–ª—å –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
@dp.callback_query_handler(lambda c: c.data == 'profile')
async def show_profile(callback: types.CallbackQuery):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"""
    user_id = callback.from_user.id
    user_data = get_user_db(user_id)
    
    if user_data:
        reports_available, is_premium, total_sent = user_data
        
        premium_status = "‚úÖ –ê–ö–¢–ò–í–ù–ê" if is_premium else "‚ùå –ù–µ –∞–∫—Ç–∏–≤–Ω–∞"
        reports_display = '‚àû' if is_premium else reports_available
        
        profile_text = (
            f"üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n\n"
            f"üíé –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞: {premium_status}\n"
            f"üìä –î–æ—Å—Ç—É–ø–Ω–æ –¥–æ–Ω–æ—Å–æ–≤: {reports_display}\n"
            f"üì® –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {total_sent}\n"
            f"üÜî ID: {user_id}"
        )
        
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text=profile_text,
            reply_markup=main_menu()
        )

@dp.callback_query_handler(lambda c: c.data == 'referral')
async def show_referral(callback: types.CallbackQuery):
    """–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"""
    user_id = callback.from_user.id
    
    try:
        bot_user = await bot.get_me()
        referral_link = f"https://t.me/{bot_user.username}?start={user_id}"
        
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute('SELECT COUNT(*) FROM users WHERE referred_by = ?', (user_id,))
        referrals_count = cursor.fetchone()[0]
        conn.close()
        
        referral_text = (
            f"üìä –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞\n\n"
            f"üîó –í–∞—à–∞ —Å—Å—ã–ª–∫–∞:\n`{referral_link}`\n\n"
            f"üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {referrals_count}\n\n"
            f"üíé –ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ:\n"
            f"‚Ä¢ +1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ–Ω–æ—Å\n"
            f"‚Ä¢ –ë–æ–Ω—É—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        )
        
        await bot.edit_message_text(
            chat_id=callback.message.chat.id,
            message_id=callback.message.message_id,
            text=referral_text,
            parse_mode="Markdown",
            reply_markup=main_menu()
        )
    except Exception as e:
        logger.error(f"Referral system error: {e}")

@dp.callback_query_handler(lambda c: c.data == 'subscription')
async def show_subscription(callback: types.CallbackQuery):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ"""
    subscription_text = (
        "üíé –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞\n\n"
        "üöÄ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –¥–æ–Ω–æ—Å—ã\n"
        "‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞\n"
        "üîí –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å\n"
        "üìß –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º SMTP-–∞–∫–∫–∞—É–Ω—Ç–∞–º\n\n"
        "üí≥ –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É @BloodyLofiPro_bot"
    )
    
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text=subscription_text,
        reply_markup=main_menu()
    )

# –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
@dp.callback_query_handler(lambda c: c.data == 'admin_panel')
async def admin_panel_callback(callback: types.CallbackQuery):
    """–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"""
    user_id = callback.from_user.id
    if user_id not in ADMIN_IDS:
        await callback.answer("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤", show_alert=True)
        return
    
    await bot.edit_message_text(
        chat_id=callback.message.chat.id,
        message_id=callback.message.message_id,
        text="üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:",
        reply_markup=admin_keyboard()
    )

@dp.callback_query_handler(lambda c: c.data == 'admin_give_sub')
async def admin_give_sub(callback: types.CallbackQuery, state: FSMContext):
    """–í—ã–¥–∞—á–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"""
    user_id = callback.from_user.id
    if user_id not in ADMIN_IDS:
        return
    
    await callback.message.answer("–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–∞—á–∏ –ø–æ–¥–ø–∏—Å–∫–∏:")
    await state.set_state("admin_wait_user_id")

@dp.message_handler(state="admin_wait_user_id")
async def admin_process_user_id(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–∞—á–∏ –ø–æ–¥–ø–∏—Å–∫–∏"""
    try:
        target_user_id = int(message.text)
        
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        cursor.execute('UPDATE users SET is_premium = TRUE WHERE user_id = ?', (target_user_id,))
        conn.commit()
        conn.close()
        
        await message.answer(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {target_user_id} –≤—ã–¥–∞–Ω–∞ –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞!")
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            await bot.send_message(
                target_user_id,
                "üéâ –í–∞–º –≤—ã–¥–∞–Ω–∞ –ü–†–ï–ú–ò–£–ú –ü–û–î–ü–ò–°–ö–ê!\n\n"
                "–¢–µ–ø–µ—Ä—å —É –≤–∞—Å:\n"
                "‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –¥–æ–Ω–æ—Å—ã\n"
                "‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞\n"
                "üîí –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å"
            )
        except Exception:
            pass
            
    except ValueError:
        await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    
    await state.finish()

@dp.callback_query_handler(lambda c: c.data == 'admin_stats')
async def admin_stats_callback(callback: types.CallbackQuery):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"""
    user_id = callback.from_user.id
    if user_id not in ADMIN_IDS:
        return
    
    await stats_command(callback.message)

# –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email
async def send_email(to_email, template_name, user_data, category):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP"""
    try:
        # –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ email –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
        email, password = random.choice(list(EMAILS.items()))
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
        template_text = TEMPLATES[category][template_name]
        
        # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        parsed_data = parse_user_data(user_data, category, template_name)
        
        # –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω–µ
        message_text = template_text
        for key, value in parsed_data.items():
            message_text = message_text.replace(f"{{{key}}}", value)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        msg = MIMEMultipart()
        msg['From'] = email
        msg['To'] = to_email
        msg['Subject'] = f"–°—Ä–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - {template_name}"
        
        msg.attach(MIMEText(message_text, 'plain', 'utf-8'))
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ SMTP
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls()
        server.login(email, password)
        server.send_message(msg)
        server.quit()
        
        logger.info(f"Email sent successfully from {email} to {to_email}")
        return True
        
    except Exception as e:
        logger.error(f"SMTP error: {e}")
        return False

# –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def parse_user_data(user_data, category, template_name):
    """–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –í–°–ï–• –∫–∞—Ç–µ–≥–æ—Ä–∏–π"""
    parts = [part.strip() for part in user_data.split(',')]
    parsed = {}
    
    parsing_templates = {
        "school": {
            "–î–æ–Ω–æ—Å –Ω–∞ —É—á–µ–Ω–∏–∫–∞": ['—à–∫–æ–ª–∞', '—Ñ–∏–æ_–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞', '–∫–ª–∞—Å—Å', '—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞', '–¥–∞—Ç–∞', '–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞'],
            "–ñ–∞–ª–æ–±–∞ –Ω–∞ —É—á–∏—Ç–µ–ª—è": ['—à–∫–æ–ª–∞', '—Ñ–∏–æ_—Ä–æ–¥–∏—Ç–µ–ª—è', '–∫–ª–∞—Å—Å', '—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞', '—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è', '–¥–∞—Ç–∞', '–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω'],
            "–ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥—É—é —à–∫–æ–ª—É": ['—Ñ–∏–æ', '–∫–ª–∞—Å—Å', '—à–∫–æ–ª–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω', '—Ñ–∏–æ_—Ä–æ–¥–∏—Ç–µ–ª—è'],
            "–§–∞–ª—å—à–∏–≤—ã–π –∫–∞—Ä–∞–Ω—Ç–∏–Ω": ['—à–∫–æ–ª–∞', '–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ', '–∫–ª–∞—Å—Å', '—Ñ–∏–æ', '–¥–∞—Ç–∞', '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ_—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ', '–ø–µ—Ä–∏–æ–¥', '—Å–ø–∏—Å–æ–∫_–ø–æ–º–µ—â–µ–Ω–∏–π', '–¥–Ω–∏', '—Ç–µ–ª–µ—Ñ–æ–Ω', '—Ñ–∏–æ_–≤—Ä–∞—á–∞'],
            "–ü–æ–¥—Å—Ç–∞–≤–Ω–æ–π —Ä–æ–º–∞–Ω": ['—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è', '–¥–∞—Ç–∞', '—Å—Ä–æ–∫', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–≤—Ä–µ–º—è_–Ω–∞—á–∞–ª–∞', '–≤—Ä–µ–º—è_–∫–æ–Ω—Ü–∞', '–∞–Ω–æ–Ω–∏–º–Ω–æ–µ_–∏–º—è'],
            "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ": ['—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è', '—Ñ–∏–æ_—É—á–µ–Ω–∏–∫–∞', '–∫–ª–∞—Å—Å', '—Å—É–º–º–∞', '–¥–∞—Ç–∞', '–Ω–æ–º–µ—Ä_–∫–∞—Ä—Ç—ã', '—Ñ–∏–æ_–ø–æ–ª—É—á–∞—Ç–µ–ª—è'],
            "–§–µ–π–∫–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ": ['—à–∫–æ–ª–∞', '–∫–ª–∞—Å—Å', '–¥–∞—Ç–∞', '–≤—Ä–µ–º—è', '–º–µ—Å—Ç–æ', '—Ñ–∏–æ_—É—á–∏—Ç–µ–ª—è', '—Ñ–∏–æ_–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω']
        },
        "swatting": {
            "–ú–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã": ['–∞–¥—Ä–µ—Å', '–≤—Ä–µ–º—è'],
            "–ó–∞—Ö–≤–∞—Ç –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤": ['–∞–¥—Ä–µ—Å', '—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è', '—Ç–µ–ª–µ—Ñ–æ–Ω'],
            "–í–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ": ['–∞–¥—Ä–µ—Å', '–≤—Ä–µ–º—è']
        },
        "corporate": {
            "–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ": ['—Ñ–∏–æ_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', '–∫–æ–º–ø–∞–Ω–∏—è', '–ø—Ä–∏—á–∏–Ω–∞_—É–≤–æ–ª—å–Ω–µ–Ω–∏—è', '–¥–∞—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω_–æ—Ç–¥–µ–ª–∞'],
            "–ü—Ä–µ–º–∏—è": ['—Ñ–∏–æ_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', '–∫–æ–º–ø–∞–Ω–∏—è', '—Å—É–º–º–∞', '–¥–∞—Ç–∞', '–Ω–æ–º–µ—Ä_–ø—Ä–∏–∫–∞–∑–∞', '–¥–∞—Ç–∞_–ø—Ä–∏–∫–∞–∑–∞'],
            "–ê—É–¥–∏—Ç": ['–æ—Ç–¥–µ–ª', '–¥–∞—Ç–∞', '–≤—Ä–µ–º—è', '—Ñ–∏–æ_–ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö', '–ø—Ä–∏—á–∏–Ω–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏']
        },
        "personal": {
            "–®–∞–Ω—Ç–∞–∂ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏": ['—Ñ–∏–æ_—Ü–µ–ª–∏', '—Ñ–∏–æ_–ø–∞—Ä—Ç–Ω–µ—Ä–∞', '—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è', '–¥–∞—Ç–∞'],
            "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å": ['—Ñ–∏–æ_–º—É–∂—á–∏–Ω—ã', '—Å—Ä–æ–∫', '–¥–∞—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–∞–Ω–æ–Ω–∏–º–Ω–æ–µ_–∏–º—è'],
            "–î–æ–ª–≥": ['—Ñ–∏–æ_–¥–æ–ª–∂–Ω–∏–∫–∞', '—Å—É–º–º–∞', '–¥–∞—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω_–∫—Ä–µ–¥–∏—Ç–æ—Ä–∞', '—Ä–µ–∫–≤–∏–∑–∏—Ç—ã']
        },
        "government": {
            "–ù–∞–ª–æ–≥–∏": ['—Ñ–∏–æ', '–∞–¥—Ä–µ—Å', '—Å—É–º–º–∞', '–¥–∞—Ç–∞', '—Ç–µ–ª–µ—Ñ–æ–Ω_–∏–Ω—Å–ø–µ–∫—Ü–∏–∏'],
            "–®—Ç—Ä–∞—Ñ—ã –ì–ò–ë–î–î": ['—Ñ–∏–æ', '–Ω–æ–º–µ—Ä_–∞–≤—Ç–æ', '–Ω–∞—Ä—É—à–µ–Ω–∏–µ', '—Å—É–º–º–∞', '–¥–∞—Ç–∞', '–Ω–æ–º–µ—Ä_–ø—Ä–æ—Ç–æ–∫–æ–ª–∞', '—Ñ–∏–æ_–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞'],
            "–ü–æ–≤–µ—Å—Ç–∫–∞ –≤ —Å—É–¥": ['—Ñ–∏–æ', '–¥–∞—Ç–∞', '–≤—Ä–µ–º—è', '–∞–¥—Ä–µ—Å_—Å—É–¥–∞', '–ø—Ä–∏—á–∏–Ω–∞', '–∫–∞–±–∏–Ω–µ—Ç', '—Ñ–∏–æ_—Å—É–¥—å–∏', '–Ω–æ–º–µ—Ä_–¥–µ–ª–∞']
        },
        "crypto": {
            "–í—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –±–∏—Ç–∫–æ–∏–Ω": ['—Å—É–º–º–∞_btc', 'btc_–∞–¥—Ä–µ—Å', '–¥–∞—Ç–∞'],
            "–ú–∞–π–Ω–∏–Ω–≥": ['—Å—É–º–º–∞', '–∫–æ—à–µ–ª–µ–∫'],
            "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞": ['–∫–æ—à–µ–ª–µ–∫', '–ø—Ä–∏—á–∏–Ω–∞', '—Å—É–º–º–∞', '–∫–æ—à–µ–ª–µ–∫_–æ–ø–ª–∞—Ç—ã', '–¥–∞—Ç–∞']
        }
    }
    
    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —à–∞–±–ª–æ–Ω—É
    template_fields = parsing_templates.get(category, {}).get(template_name, [])
    for i, field in enumerate(template_fields):
        if i < len(parts):
            parsed[field] = parts[i]
        else:
            parsed[field] = "[–Ω–µ —É–∫–∞–∑–∞–Ω–æ]"
    
    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    template_text = TEMPLATES[category][template_name]
    variables = re.findall(r'\{(\w+)\}', template_text)
    for var in variables:
        if var not in parsed:
            parsed[var] = "[–Ω–µ —É–∫–∞–∑–∞–Ω–æ]"
    
    return parsed

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
@dp.errors_handler()
async def errors_handler(update, exception):
    """–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(f"Update {update} caused error {exception}")
    return True

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == '__main__':
    logger.info("Starting bot...")
    try:
        executor.start_polling(dp, skip_updates=True)
    except Exception as e:
        logger.error(f"Bot startup error: {e}")
